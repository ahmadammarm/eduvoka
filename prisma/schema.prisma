// =======================
// GENERATOR
// =======================
generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

// =======================
// DATASOURCE
// =======================
datasource db {
  provider = "mysql"
}

// =======================
// ENUM
// =======================
enum soalutbk_tipe {
  PU // Pengetahuan Umum
  PBM // Pemahaman Bacaan & Menulis
  PPU // Pengetahuan & Pemahaman Umum
  PK // Pengetahuan Kuantitatif
  LITERASIBINDO
  LITERASIBINGG
}

enum jawabankuisvak_tipeJawaban {
  VISUAL
  AUDITORY
  KINESTHETIC
}

enum user_gayaBelajar {
  VISUAL
  AUDITORY
  KINESTHETIC
}

enum user_role {
  USER
  ADMIN
}

enum user_paketUser {
  BASIC
  LITE
  ACTIVE
  EDUVOKA
}

// =======================
// MODEL
// =======================

model user {
  id                String            @id
  email             String            @unique(map: "User_email_key")
  name              String
  password          String?
  profileImage      String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  gayaBelajar       user_gayaBelajar?
  role              user_role         @default(USER)
  paketUser         user_paketUser    @default(BASIC)
  isSubscribed      Boolean           @default(false)
  subscriptionEndAt DateTime?

  account            account[]
  session            session[]
  jawabanuserkuisvak jawabanuserkuisvak[]
  utbk_session       utbk_session[]
}

model account {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user user @relation(fields: [userId], references: [id], onDelete: Cascade, map: "Account_userId_fkey")

  @@unique([provider, providerAccountId], map: "Account_provider_providerAccountId_key")
  @@index([userId], map: "Account_userId_fkey")
}

model session {
  id           String   @id
  sessionToken String   @unique(map: "Session_sessionToken_key")
  userId       String
  expires      DateTime

  user user @relation(fields: [userId], references: [id], onDelete: Cascade, map: "Session_userId_fkey")

  @@index([userId], map: "Session_userId_fkey")
}

model pertanyaankuisvak {
  id         String   @id
  pertanyaan String   @db.Text
  createdAt  DateTime @default(now())
  updatedAt  DateTime

  jawabankuisvak     jawabankuisvak[]
  jawabanuserkuisvak jawabanuserkuisvak[]
}

model jawabankuisvak {
  id          String                     @id
  kuisVAKId   String
  jawaban     String
  tipeJawaban jawabankuisvak_tipeJawaban
  createdAt   DateTime                   @default(now())
  updatedAt   DateTime

  pertanyaankuisvak  pertanyaankuisvak    @relation(fields: [kuisVAKId], references: [id], onDelete: Cascade, map: "JawabanKuisVAK_kuisVAKId_fkey")
  jawabanuserkuisvak jawabanuserkuisvak[]

  @@index([kuisVAKId], map: "JawabanKuisVAK_kuisVAKId_fkey")
}

model jawabanuserkuisvak {
  id                  String   @id
  userId              String
  pertanyaanKuisVAKId String
  jawabanKuisVAKId    String
  createdAt           DateTime @default(now())
  updatedAt           DateTime

  user              user              @relation(fields: [userId], references: [id], onDelete: Cascade, map: "JawabanUserKuisVAK_userId_fkey")
  pertanyaankuisvak pertanyaankuisvak @relation(fields: [pertanyaanKuisVAKId], references: [id], onDelete: Cascade, map: "JawabanUserKuisVAK_pertanyaanKuisVAKId_fkey")
  jawabankuisvak    jawabankuisvak    @relation(fields: [jawabanKuisVAKId], references: [id], onDelete: Cascade, map: "JawabanUserKuisVAK_jawabanKuisVAKId_fkey")

  @@unique([userId, pertanyaanKuisVAKId], map: "JawabanUserKuisVAK_userId_pertanyaanKuisVAKId_key")
  @@index([jawabanKuisVAKId], map: "JawabanUserKuisVAK_jawabanKuisVAKId_fkey")
  @@index([pertanyaanKuisVAKId], map: "JawabanUserKuisVAK_pertanyaanKuisVAKId_fkey")
}

model soalutbk {
  id           String        @id
  tipe         soalutbk_tipe
  content      String        @db.Text
  kunciJawaban String

  pilihanjawaban pilihanjawaban[]
  pembahasan     pembahasansoalutbk[]
  jawabanUser    utbk_jawaban_user[]
}

model pilihanjawaban {
  id         String @id
  soalUTBKId String
  label      String // A, B, C, D, E
  pilihan    String

  soalutbk    soalutbk            @relation(fields: [soalUTBKId], references: [id], onDelete: Cascade, map: "PilihanJawaban_soalUTBKId_fkey")
  jawabanUser utbk_jawaban_user[]

  @@index([soalUTBKId], map: "PilihanJawaban_soalUTBKId_fkey")
}

model pembahasansoalutbk {
  id          String           @id
  soalUTBKId  String
  gayaBelajar user_gayaBelajar
  konten      String           @db.Text
  createdAt   DateTime         @default(now())
  updatedAt   DateTime

  soalutbk soalutbk @relation(fields: [soalUTBKId], references: [id], onDelete: Cascade)

  @@unique([soalUTBKId, gayaBelajar])
  @@index([soalUTBKId])
}

model utbk_session {
  id        String    @id
  userId    String
  startedAt DateTime  @default(now())
  endedAt   DateTime?
  score     Int?

  user    user                @relation(fields: [userId], references: [id], onDelete: Cascade)
  jawaban utbk_jawaban_user[]

  @@index([userId])
}

model utbk_jawaban_user {
  id         String    @id
  sessionId  String
  soalUTBKId String
  pilihanId  String? // null jika tidak dijawab
  isCorrect  Boolean?
  answeredAt DateTime?

  session        utbk_session    @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  soalutbk       soalutbk        @relation(fields: [soalUTBKId], references: [id], onDelete: Cascade)
  pilihanjawaban pilihanjawaban? @relation(fields: [pilihanId], references: [id])

  @@unique([sessionId, soalUTBKId])
  @@index([soalUTBKId])
}
